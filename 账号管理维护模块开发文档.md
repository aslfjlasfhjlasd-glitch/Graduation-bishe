# 账号管理维护模块开发文档

## 📋 模块概述

本模块为管理员端新增的"账号管理维护"功能，实现对学生（`student`）和负责人（`department_head`）两类账号的完整 CRUD 操作，包括：
- ✅ 分页查询账号列表
- ✅ 新增账号（带学号/工号查重）
- ✅ 编辑账号信息
- ✅ 重置密码（默认 123456）
- ✅ 删除账号

---

## 🏗️ 架构设计

采用 **RESTful API + 前端组件化** 的标准架构：

```
前端 (Vue 3)
  └─ AccountManagement.vue (Tab切换：学生/负责人)
      └─ API调用 (admin.js)
          └─ 后端 (Spring Boot)
              ├─ AdminController (统一入口)
              ├─ StudentService / DepartmentHeadService (业务逻辑)
              └─ StudentMapper / DepartmentHeadMapper (数据访问)
```

---

## 📁 文件清单

### 后端文件 (Backend)

#### 1. DTO 数据传输对象
- `backend/src/main/java/com/university/volunteer/dto/AccountCreateDTO.java`
  - 用于新增账号，包含：学号/工号、姓名、学院/部门、电话、初始密码
  
- `backend/src/main/java/com/university/volunteer/dto/AccountUpdateDTO.java`
  - 用于更新账号，包含：ID、姓名、学院/部门、电话、密码（可选）
  
- `backend/src/main/java/com/university/volunteer/dto/AccountSearchDTO.java`
  - 用于搜索查询，包含：关键词、页码、每页大小、账号类型

#### 2. Mapper 接口与 XML
- `backend/src/main/java/com/university/volunteer/mapper/StudentMapper.java`
  - 新增方法：`findStudentsByPage`, `existsByStudentId`, `insertStudent`, `deleteStudent`
  
- `backend/src/main/resources/mapper/StudentMapper.xml`
  - 实现分页查询、查重、插入、删除的 SQL 语句
  
- `backend/src/main/java/com/university/volunteer/mapper/DepartmentHeadMapper.java`
  - 新增方法：`findDepartmentHeadsByPage`, `existsByUsername`, `insertDepartmentHead`, `deleteDepartmentHead`
  
- `backend/src/main/resources/mapper/DepartmentHeadMapper.xml`
  - 实现负责人的 CRUD SQL 语句

#### 3. Service 业务层
- `backend/src/main/java/com/university/volunteer/service/StudentService.java`
  - 新增方法：
    - `getStudentsByPage()` - 分页查询
    - `createStudent()` - 创建学生（含查重）
    - `updateStudentAccount()` - 更新学生信息
    - `resetStudentPassword()` - 重置密码
    - `deleteStudent()` - 删除学生
  
- `backend/src/main/java/com/university/volunteer/service/DepartmentHeadService.java`
  - 新增方法：
    - `getDepartmentHeadsByPage()` - 分页查询
    - `createDepartmentHead()` - 创建负责人（含查重）
    - `updateDepartmentHeadAccount()` - 更新负责人信息
    - `resetDepartmentHeadPassword()` - 重置密码
    - `deleteDepartmentHead()` - 删除负责人

#### 4. Controller 控制层
- `backend/src/main/java/com/university/volunteer/controller/AdminController.java`
  - 新增 RESTful API 端点（共 10 个）：
    - `GET /api/admin/accounts/student/list` - 获取学生列表
    - `POST /api/admin/accounts/student/add` - 新增学生
    - `PUT /api/admin/accounts/student/update` - 更新学生
    - `POST /api/admin/accounts/student/reset-pwd` - 重置学生密码
    - `DELETE /api/admin/accounts/student/{id}` - 删除学生
    - `GET /api/admin/accounts/head/list` - 获取负责人列表
    - `POST /api/admin/accounts/head/add` - 新增负责人
    - `PUT /api/admin/accounts/head/update` - 更新负责人
    - `POST /api/admin/accounts/head/reset-pwd` - 重置负责人密码
    - `DELETE /api/admin/accounts/head/{username}` - 删除负责人

### 前端文件 (Frontend)

#### 1. API 接口封装
- `frontend/src/api/admin.js`
  - 新增 10 个 API 函数，与后端接口一一对应

#### 2. Vue 组件
- `frontend/src/views/admin/components/AccountManagement.vue`
  - 完整的账号管理界面，包含：
    - Tab 切换（学生/负责人）
    - 搜索栏（支持姓名/学号/工号搜索）
    - 数据表格（分页显示）
    - 新增/编辑弹窗
    - 操作按钮（编辑、重置密码、删除）

#### 3. 路由集成
- `frontend/src/views/admin/Dashboard.vue`
  - 在左侧菜单新增"账号管理维护"入口
  - 集成 `AccountManagement` 组件

---

## 🔑 核心功能实现

### 1. 学号/工号查重机制

**后端实现**：
```java
// 在创建账号前先查询是否存在
Integer count = studentMapper.existsByStudentId(studentId);
if (count != null && count > 0) {
    return Result.error("学号已存在");
}
```

**SQL 实现**：
```xml
<select id="existsByStudentId" resultType="java.lang.Integer">
    SELECT COUNT(*) FROM t_xs WHERE XS_XH = #{studentId}
</select>
```

### 2. 密码管理策略

- **存储方式**：明文存储（与现有登录逻辑保持一致）
- **默认密码**：`123456`
- **重置密码**：管理员可一键重置为默认密码
- **安全提示**：
  - 新增账号时，如果不填写密码，自动使用默认密码
  - 编辑账号时，密码框为空则不修改密码
  - 重置密码需要二次确认

### 3. 分页查询实现

**后端手动分页**：
```java
List<Student> students = studentMapper.findStudentsByPage(keyword);
int total = students.size();
int start = (page - 1) * size;
int end = Math.min(start + size, total);
List<Student> pageData = students.subList(start, end);
```

**前端分页控制**：
```vue
<div class="pagination">
  <button :disabled="page === 1" @click="handlePageChange(page - 1)">
    上一页
  </button>
  <button :disabled="page >= Math.ceil(total / size)" @click="handlePageChange(page + 1)">
    下一页
  </button>
</div>
```

### 4. 搜索功能

**支持模糊搜索**：
```xml
<where>
    <if test="keyword != null and keyword != ''">
        AND (XS_XM LIKE CONCAT('%', #{keyword}, '%') 
        OR XS_XH LIKE CONCAT('%', #{keyword}, '%'))
    </if>
</where>
```

---

## 🎨 用户界面设计

### 页面布局

```
┌─────────────────────────────────────────────────┐
│  账号管理维护                                    │
├─────────────────────────────────────────────────┤
│  [学生账号管理] | [负责人账号管理]  ← Tab切换    │
├─────────────────────────────────────────────────┤
│  [搜索框___________] [搜索] [重置] [+ 新增用户]  │
├─────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────┐  │
│  │ 学号 │ 姓名 │ 学院 │ 电话 │ 操作        │  │
│  ├───────────────────────────────────────────┤  │
│  │ 2021001 │ 张三 │ 计算机 │ 138... │      │  │
│  │                    [编辑][重置密码][删除] │  │
│  └───────────────────────────────────────────┘  │
│  共 50 条，第 1/5 页  [上一页] [下一页]         │
└─────────────────────────────────────────────────┘
```

### 弹窗设计

**新增/编辑账号弹窗**：
- 学号/工号（新增时可编辑，编辑时禁用）
- 姓名（必填）
- 学院/部门（必填）
- 联系电话（可选）
- 初始密码（仅新增时显示，可选）

---

## 🔒 安全性考虑

### 1. 权限控制
- 仅管理员（`superadmin`）可访问此模块
- 前端路由守卫检查 `userRole`
- 后端接口统一在 `/api/admin` 路径下

### 2. 数据验证
- **学号验证**：必须为数字
- **电话验证**：11 位手机号格式（可选）
- **必填字段**：学号/工号、姓名、学院/部门

### 3. 操作确认
- 删除账号：弹出确认框，提示"此操作不可恢复"
- 重置密码：弹出确认框，显示新密码

### 4. 错误处理
- 学号/工号重复：提示"学号已存在"
- 网络错误：提示"操作失败，请稍后重试"
- 数据库错误：返回具体错误信息

---

## 📊 数据库表结构

### 学生表 (t_xs)
```sql
XS_XH    INT PRIMARY KEY    -- 学号
XS_XM    VARCHAR(50)        -- 姓名
XS_MM    VARCHAR(50)        -- 密码
XS_DH    VARCHAR(20)        -- 电话
SS_XY    VARCHAR(50)        -- 所属学院
```

### 负责人表 (t_xjbmfzr)
```sql
XJBMFZR_ZH    VARCHAR(50) PRIMARY KEY    -- 工号
XJBMFZR_XM    VARCHAR(50)                -- 姓名
XJBMFZR_MM    VARCHAR(50)                -- 密码
XJBMFZR_DH    VARCHAR(20)                -- 电话
XJBM_MC       VARCHAR(50)                -- 部门名称
```

---

## 🧪 测试指南

### 1. 功能测试清单

#### 学生账号管理
- [ ] 查看学生列表（分页正常）
- [ ] 搜索学生（按姓名/学号）
- [ ] 新增学生（学号查重生效）
- [ ] 编辑学生信息
- [ ] 重置学生密码
- [ ] 删除学生账号

#### 负责人账号管理
- [ ] 查看负责人列表（分页正常）
- [ ] 搜索负责人（按姓名/工号）
- [ ] 新增负责人（工号查重生效）
- [ ] 编辑负责人信息
- [ ] 重置负责人密码
- [ ] 删除负责人账号

### 2. 边界测试

- **学号重复**：尝试添加已存在的学号，应提示错误
- **空数据**：必填字段为空时，应阻止提交
- **分页边界**：第一页禁用"上一页"，最后一页禁用"下一页"
- **搜索无结果**：显示"暂无数据"

### 3. 集成测试

1. **启动后端**：
   ```bash
   cd backend
   mvn spring-boot:run
   ```

2. **启动前端**：
   ```bash
   cd frontend
   npm run dev
   ```

3. **访问测试**：
   - 登录管理员账号
   - 点击左侧菜单"账号管理维护"
   - 执行各项操作测试

---

## 🚀 部署说明

### 后端部署
1. 确保数据库表 `t_xs` 和 `t_xjbmfzr` 存在
2. 编译打包：`mvn clean package`
3. 运行：`java -jar target/volunteer-0.0.1-SNAPSHOT.jar`

### 前端部署
1. 构建生产版本：`npm run build`
2. 部署 `dist` 目录到 Web 服务器

---

## 📝 使用说明

### 管理员操作流程

#### 新增学生账号
1. 点击左侧菜单"账号管理维护"
2. 确保在"学生账号管理" Tab
3. 点击"+ 新增用户"按钮
4. 填写表单：
   - 学号（必填，纯数字）
   - 姓名（必填）
   - 学院（必填）
   - 联系电话（可选）
   - 初始密码（可选，默认 123456）
5. 点击"确定"提交
6. 系统自动刷新列表

#### 重置密码
1. 在账号列表中找到目标账号
2. 点击"重置密码"按钮
3. 确认操作
4. 密码重置为 `123456`
5. 通知用户新密码

#### 删除账号
1. 在账号列表中找到目标账号
2. 点击"删除"按钮
3. 确认操作（不可恢复）
4. 账号被永久删除

---

## ⚠️ 注意事项

### 1. 密码安全
- 当前系统使用明文存储密码
- 建议生产环境升级为加密存储（MD5/BCrypt）
- 提醒用户首次登录后修改密码

### 2. 数据备份
- 删除操作不可恢复
- 建议定期备份数据库
- 重要操作前先导出数据

### 3. 性能优化
- 当前使用手动分页，数据量大时可能影响性能
- 建议升级为 MyBatis PageHelper 插件
- 考虑添加索引优化查询

### 4. 扩展建议
- 可添加批量导入功能（Excel）
- 可添加账号状态管理（启用/禁用）
- 可添加操作日志记录

---

## 🐛 常见问题

### Q1: 新增账号时提示"学号已存在"
**A**: 检查数据库中是否已有相同学号的记录，学号必须唯一。

### Q2: 重置密码后用户无法登录
**A**: 确认登录逻辑中的密码验证方式与存储方式一致（当前为明文）。

### Q3: 分页显示不正确
**A**: 检查后端返回的 `total` 字段是否正确，前端分页计算是否有误。

### Q4: 删除账号后相关数据怎么办
**A**: 当前实现会先删除学生的标签关联，再删除学生记录。如有其他关联数据，需要扩展删除逻辑。

---

## 📞 技术支持

如有问题，请联系开发团队或查看以下资源：
- 项目文档：`README.md`
- API 文档：`/api/admin/accounts/**`
- 数据库文档：`universityta.sql`

---

## 📅 版本历史

- **v1.0.0** (2025-12-13)
  - ✅ 完成学生账号管理功能
  - ✅ 完成负责人账号管理功能
  - ✅ 实现分页、搜索、CRUD 操作
  - ✅ 集成到管理员端 Dashboard

---

**开发完成时间**: 2025年12月13日  
**开发者**: AI Assistant  
**状态**: ✅ 开发完成，待测试