-- ============================================
-- 志愿活动"未申报"状态数据迁移脚本
-- ============================================
-- 功能说明：
-- 将数据库中所有发布状态为"待申报"的活动更新为"未申报"
-- 以保证系统一致性，使旧数据也能正确显示"申报"按钮
-- ============================================
-- 执行时间：2025-12-14
-- 作者：系统管理员
-- ============================================

-- 1. 查看当前"待申报"状态的活动数量（执行前检查）
SELECT COUNT(*) AS '待申报活动数量' 
FROM t_zyhd 
WHERE FB_ZT = '待申报';

-- 2. 查看这些活动的详细信息（可选，用于确认）
SELECT HD_BH AS '活动编号', 
       HD_MC AS '活动名称', 
       HD_FQ_DW AS '发起单位', 
       FB_ZT AS '发布状态',
       HD_ZT AS '活动状态'
FROM t_zyhd 
WHERE FB_ZT = '待申报'
ORDER BY HD_BH;

-- 3. 执行更新操作：将"待申报"改为"未申报"
UPDATE t_zyhd 
SET FB_ZT = '未申报'
WHERE FB_ZT = '待申报';

-- 4. 验证更新结果
SELECT COUNT(*) AS '未申报活动数量' 
FROM t_zyhd 
WHERE FB_ZT = '未申报';

-- 5. 确认"待申报"状态已不存在
SELECT COUNT(*) AS '待申报活动数量（应为0）' 
FROM t_zyhd 
WHERE FB_ZT = '待申报';

-- 6. 查看所有发布状态的分布情况
SELECT FB_ZT AS '发布状态', 
       COUNT(*) AS '活动数量'
FROM t_zyhd 
GROUP BY FB_ZT
ORDER BY 
  CASE FB_ZT
    WHEN '未申报' THEN 1
    WHEN '待发布' THEN 2
    WHEN '已发布' THEN 3
    WHEN '已下架' THEN 4
    ELSE 5
  END;

-- ============================================
-- 执行说明：
-- 1. 建议先在测试环境执行此脚本
-- 2. 执行前请备份数据库
-- 3. 执行步骤1和2查看待更新的数据
-- 4. 确认无误后执行步骤3进行更新
-- 5. 执行步骤4-6验证更新结果
-- ============================================

-- 回滚脚本（如需恢复，请谨慎使用）
-- UPDATE t_zyhd SET FB_ZT = '待申报' WHERE FB_ZT = '未申报';