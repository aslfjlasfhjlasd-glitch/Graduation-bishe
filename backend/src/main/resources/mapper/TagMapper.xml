<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.university.volunteer.mapper.TagMapper">

    <!-- 结果映射 -->
    <resultMap id="TagResultMap" type="com.university.volunteer.entity.Tag">
        <id property="bqId" column="BQ_ID"/>
        <result property="bqMc" column="BQ_MC"/>
        <result property="bqLx" column="BQ_LX"/>
        <result property="fId" column="F_ID"/>
        <result property="zt" column="ZT"/>
        <result property="rd" column="RD"/>
    </resultMap>

    <!-- 查询所有启用的标签 -->
    <select id="findAllEnabled" resultMap="TagResultMap">
        SELECT BQ_ID, BQ_MC, BQ_LX, F_ID, ZT, RD
        FROM t_bqzd
        WHERE ZT = 1
        ORDER BY BQ_LX, RD DESC, BQ_ID
    </select>

    <!-- 根据标签类型查询标签 -->
    <select id="findByType" resultMap="TagResultMap">
        SELECT BQ_ID, BQ_MC, BQ_LX, F_ID, ZT, RD
        FROM t_bqzd
        WHERE BQ_LX = #{bqLx} AND ZT = 1
        ORDER BY RD DESC, BQ_ID
    </select>

    <!-- 根据ID查询标签 -->
    <select id="findById" resultMap="TagResultMap">
        SELECT BQ_ID, BQ_MC, BQ_LX, F_ID, ZT, RD
        FROM t_bqzd
        WHERE BQ_ID = #{bqId}
    </select>

    <!-- 根据ID列表批量查询标签 -->
    <select id="findByIds" resultMap="TagResultMap">
        SELECT BQ_ID, BQ_MC, BQ_LX, F_ID, ZT, RD
        FROM t_bqzd
        WHERE BQ_ID IN
        <foreach collection="bqIds" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        ORDER BY BQ_LX, RD DESC
    </select>

    <!-- 根据父标签ID查询子标签 -->
    <select id="findByParentId" resultMap="TagResultMap">
        SELECT BQ_ID, BQ_MC, BQ_LX, F_ID, ZT, RD
        FROM t_bqzd
        WHERE F_ID = #{fId} AND ZT = 1
        ORDER BY RD DESC, BQ_ID
    </select>

    <!-- 插入标签 -->
    <insert id="insert" parameterType="com.university.volunteer.entity.Tag" useGeneratedKeys="true" keyProperty="bqId">
        INSERT INTO t_bqzd (BQ_MC, BQ_LX, F_ID, ZT, RD)
        VALUES (#{bqMc}, #{bqLx}, #{fId}, #{zt}, #{rd})
    </insert>

    <!-- 更新标签 -->
    <update id="update" parameterType="com.university.volunteer.entity.Tag">
        UPDATE t_bqzd
        SET BQ_MC = #{bqMc},
            BQ_LX = #{bqLx},
            F_ID = #{fId},
            ZT = #{zt},
            RD = #{rd}
        WHERE BQ_ID = #{bqId}
    </update>

    <!-- 更新标签热度 -->
    <update id="updateHotness">
        UPDATE t_bqzd
        SET RD = RD + #{increment}
        WHERE BQ_ID = #{bqId}
    </update>

    <!-- 删除标签（逻辑删除） -->
    <update id="delete">
        UPDATE t_bqzd
        SET ZT = 0
        WHERE BQ_ID = #{bqId}
    </update>

</mapper>