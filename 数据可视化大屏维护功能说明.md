# 数据可视化大屏维护功能使用说明

## 📋 功能概述

本功能模块实现了对数据可视化大屏的动态配置管理，管理员可以通过维护界面实时修改大屏的展示内容、开关控制等配置项，无需修改代码即可调整大屏显示效果。

## 🎯 核心功能

### 1. 基础设置
- **大屏主标题**：自定义大屏顶部显示的系统名称
- **大屏滚动公告**：设置跑马灯文字，用于重要通知
- **学期目标工时**：设定目标值，用于进度条展示
- **置顶推荐活动ID**：手动指定需要在大屏推荐位展示的活动

### 2. 显示开关控制
- **显示性别比例图**：控制学生性别分布饼图的显示/隐藏
- **显示学院排名**：控制学院活跃度排行榜的显示/隐藏

### 3. 实时预览
- 点击"预览大屏"按钮可在新窗口查看配置效果
- 修改配置后保存，大屏会自动应用新配置

## 🚀 部署步骤

### 第一步：执行数据库脚本

1. 打开 MySQL 数据库管理工具（如 Navicat、MySQL Workbench 或命令行）
2. 连接到你的数据库
3. 执行项目根目录下的 `sys_config_table.sql` 文件

```sql
-- 该脚本会创建 sys_config 表并初始化默认配置数据
```

**验证方法**：
```sql
-- 执行以下查询，应该能看到 6 条配置记录
SELECT * FROM sys_config;
```

### 第二步：启动后端服务

确保后端服务正常运行：

```bash
cd backend
mvn spring-boot:run
```

或使用已编译的 JAR 包：
```bash
java -jar target/volunteer-0.0.1-SNAPSHOT.jar
```

### 第三步：启动前端服务

```bash
cd frontend
npm install  # 如果是首次运行
npm run dev
```

### 第四步：访问系统

1. 打开浏览器访问：`http://localhost:5173`
2. 使用管理员账号登录
3. 在左侧菜单中点击"数据可视化大屏维护"

## 📖 使用指南

### 配置管理界面操作

1. **查看当前配置**
   - 进入维护界面后，系统会自动加载当前所有配置项
   - 表单会显示每个配置的当前值

2. **修改配置**
   - 直接在表单中修改需要更改的配置项
   - 文本框：输入新的文本内容
   - 数字框：输入新的数值
   - 开关：点击切换开/关状态

3. **保存配置**
   - 点击"保存配置"按钮
   - 系统会批量更新所有配置项
   - 保存成功后会显示成功提示

4. **重置表单**
   - 点击"重置"按钮
   - 表单会恢复到上次保存的状态

5. **预览效果**
   - 点击"预览大屏"按钮
   - 系统会在新窗口打开大屏页面
   - 可以实时查看配置效果

### 大屏展示效果

配置保存后，大屏会自动应用新配置：

1. **标题和公告**
   - 大屏顶部会显示配置的标题
   - 公告栏会以跑马灯形式滚动显示

2. **目标进度**
   - 累计活动时长卡片会显示目标进度条
   - 自动计算完成百分比

3. **图表显示**
   - 根据开关配置动态显示/隐藏图表
   - 关闭的图表会自动调整布局

## 🔧 API 接口说明

### 后端接口

#### 1. 获取所有配置列表
```
GET /api/admin/config/list
返回：配置对象数组
```

#### 2. 获取配置Map
```
GET /api/admin/config/map
返回：key-value格式的配置Map
```

#### 3. 更新单个配置
```
PUT /api/admin/config/{configKey}
请求体：{ "configValue": "新值" }
```

#### 4. 批量更新配置
```
POST /api/admin/config/batch-update
请求体：{ "key1": "value1", "key2": "value2", ... }
```

#### 5. 获取大屏配置
```
GET /api/dashboard/configs
返回：大屏所需的配置信息
```

## 📊 数据库表结构

### sys_config 表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| config_id | int | 配置ID（主键） |
| config_key | varchar(100) | 配置键名（唯一） |
| config_value | text | 配置值 |
| config_name | varchar(100) | 配置中文名称 |
| description | varchar(255) | 描述说明 |
| update_time | datetime | 更新时间 |

### 默认配置项

| 配置键 | 默认值 | 说明 |
|--------|--------|------|
| dashboard_title | 高校志愿活动智能大数据平台 | 大屏主标题 |
| dashboard_notice | 欢迎各位领导莅临指导... | 滚动公告 |
| goal_total_hours | 5000 | 学期目标工时 |
| show_gender_chart | true | 显示性别比例图 |
| show_academy_rank | true | 显示学院排名 |
| pinned_activity_ids | 1,3 | 置顶活动ID |

## 🎨 界面截图说明

### 维护界面
- 顶部：页面标题和说明
- 基础设置卡片：包含文本输入框和数字输入框
- 显示开关卡片：包含开关控件
- 底部操作按钮：保存、重置、预览
- 配置详情表格：显示所有配置的详细信息（调试用）

### 大屏界面
- 顶部：动态标题和滚动公告
- 指标卡片：显示关键数据和目标进度
- 图表区域：根据配置动态显示图表
- 响应式布局：自动适应不同屏幕尺寸

## ⚠️ 注意事项

1. **数据库必须先执行**
   - 必须先执行 `sys_config_table.sql` 创建表和初始化数据
   - 否则后端启动会报错或接口无法正常工作

2. **配置值格式**
   - 布尔值使用字符串 "true" 或 "false"
   - 数字使用字符串格式存储
   - 多个ID用逗号分隔，如 "1,3,5"

3. **权限控制**
   - 只有管理员账号可以访问维护界面
   - 普通用户只能查看大屏，不能修改配置

4. **实时生效**
   - 配置修改后立即生效
   - 大屏页面刷新后会加载最新配置
   - 无需重启服务

5. **数据验证**
   - 前端会进行基本的数据验证
   - 后端也会验证数据格式
   - 建议输入合理的配置值

## 🔍 故障排查

### 问题1：配置加载失败
**现象**：维护界面显示"加载配置失败"
**解决方案**：
1. 检查数据库表是否创建成功
2. 检查后端服务是否正常运行
3. 查看浏览器控制台的错误信息
4. 检查后端日志

### 问题2：保存配置失败
**现象**：点击保存后显示失败提示
**解决方案**：
1. 检查网络连接
2. 确认配置值格式正确
3. 查看后端日志中的错误信息

### 问题3：大屏不显示配置效果
**现象**：修改配置后大屏没有变化
**解决方案**：
1. 刷新大屏页面（F5）
2. 清除浏览器缓存
3. 检查配置是否真的保存成功
4. 查看浏览器控制台是否有错误

### 问题4：图表不显示
**现象**：大屏上某些图表不显示
**解决方案**：
1. 检查对应的开关配置是否开启
2. 检查后端数据接口是否正常
3. 查看浏览器控制台的错误信息

## 📝 扩展建议

### 可以添加的配置项

1. **主题颜色配置**
   - 主色调
   - 辅助色
   - 背景色

2. **刷新频率配置**
   - 数据自动刷新间隔
   - 图表动画速度

3. **数据源配置**
   - 数据时间范围
   - 数据过滤条件

4. **布局配置**
   - 图表排列方式
   - 卡片大小比例

### 功能增强建议

1. **配置历史记录**
   - 记录每次配置修改
   - 支持回滚到历史版本

2. **配置模板**
   - 预设多套配置方案
   - 一键切换配置模板

3. **权限细分**
   - 不同管理员可配置不同项
   - 配置审批流程

4. **实时预览**
   - 在维护界面直接预览效果
   - 无需打开新窗口

## 📞 技术支持

如有问题，请联系开发团队或查看项目文档。

---

**版本**：v1.0.0  
**更新日期**：2025-12-12  
**作者**：高校志愿平台开发团队