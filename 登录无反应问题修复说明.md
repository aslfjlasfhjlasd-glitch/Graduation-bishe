# ç™»å½•æ— ååº”é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°
ç‚¹å‡»ç™»å½•æŒ‰é’®åï¼Œé¡µé¢æ²¡æœ‰ä»»ä½•ååº”ï¼Œä¸è·³è½¬ä¹Ÿä¸æ˜¾ç¤ºé”™è¯¯æç¤ºã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### é—®é¢˜é“¾è·¯
```
ç”¨æˆ·ç‚¹å‡»ç™»å½• 
  â†“
åç«¯éªŒè¯é€šè¿‡ï¼Œè¿”å›ç”¨æˆ·æ•°æ®
  â†“
å‰ç«¯æ‰§è¡Œ router.push('/first-login')
  â†“
è§¦å‘è·¯ç”±å®ˆå« router.beforeEach()
  â†“
å®ˆå«æ£€æŸ¥ localStorage.getItem('token')
  â†“
å‘ç°æ²¡æœ‰ token âŒ
  â†“
ç«‹å³é‡å®šå‘å›ç™»å½•é¡µ next('/')
  â†“
ç”¨æˆ·çœ‹åˆ°çš„æ•ˆæœï¼šä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿ
```

### æ ¸å¿ƒé—®é¢˜
**å‰ç«¯ç™»å½•æˆåŠŸåæ²¡æœ‰ä¿å­˜ tokenï¼Œå¯¼è‡´è·¯ç”±å®ˆå«æ‹¦æˆªäº†æ‰€æœ‰è·³è½¬ï¼**

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ”¹ Login.vue æ·»åŠ  Token ä¿å­˜é€»è¾‘

åœ¨ `handleLogin` æ–¹æ³•ä¸­ï¼Œç™»å½•æˆåŠŸåç«‹å³ä¿å­˜ tokenï¼š

```javascript
if (result.code === 200) {
  // ğŸ”¥ å…³é”®ä¿®å¤ï¼šä¿å­˜ Token
  if (result.data && result.data.token) {
    localStorage.setItem('token', result.data.token);
  } else if (result.token) {
    localStorage.setItem('token', result.token);
  } else {
    // åç«¯æœªè¿”å›tokenï¼Œä½¿ç”¨ä¸´æ—¶mock token
    const mockToken = `mock-token-${role}-${username.value}-${Date.now()}`;
    localStorage.setItem('token', mockToken);
  }
  
  // å…¶ä»–é€»è¾‘...
}
```

### 2. æ·»åŠ è°ƒè¯•æ—¥å¿—

ä¸ºäº†æ–¹ä¾¿æ’æŸ¥é—®é¢˜ï¼Œæ·»åŠ äº†è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼š

```javascript
console.log('ğŸ‘† æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼Œæ­£åœ¨å°è¯•ç™»å½•è§’è‰²:', role);
console.log('ğŸ“¡ åç«¯è¿”å›ç»“æœ:', result);
console.log('ğŸ’¾ Tokenå·²ä¿å­˜:', localStorage.getItem('token'));
console.log('ğŸš€ å‡†å¤‡è·³è½¬åˆ° /first-login');
```

## ğŸ“‹ ä¿®å¤åçš„å®Œæ•´æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®
   â†“
2. è°ƒç”¨åç«¯ /api/auth/login
   â†“
3. åç«¯éªŒè¯æˆåŠŸï¼Œè¿”å›ç”¨æˆ·æ•°æ®
   â†“
4. å‰ç«¯ä¿å­˜ token åˆ° localStorage âœ…
   â†“
5. ä¿å­˜å…¶ä»–ç”¨æˆ·ä¿¡æ¯ï¼ˆstudentId, roleç­‰ï¼‰
   â†“
6. æ£€æŸ¥æ˜¯å¦ä¸ºé»˜è®¤å¯†ç 123456
   â†“
7. æ‰§è¡Œ router.push('/first-login')
   â†“
8. è·¯ç”±å®ˆå«æ£€æŸ¥ token
   â†“
9. token å­˜åœ¨ âœ…ï¼Œæ”¾è¡Œ
   â†“
10. æˆåŠŸè·³è½¬åˆ°é¦–æ¬¡ç™»å½•è®¾ç½®é¡µé¢
```

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. æ¸…é™¤æ—§æ•°æ®
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.clear();
```

### 2. é‡æ–°ç™»å½•
1. è¾“å…¥å­¦å·å’Œå¯†ç  `123456`
2. ç‚¹å‡»"å­¦ç”Ÿ"æŒ‰é’®
3. è§‚å¯Ÿæµè§ˆå™¨æ§åˆ¶å°è¾“å‡º

### 3. é¢„æœŸæ§åˆ¶å°è¾“å‡º
```
ğŸ‘† æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼Œæ­£åœ¨å°è¯•ç™»å½•è§’è‰²: student
ğŸ“¡ åç«¯è¿”å›ç»“æœ: {code: 200, data: {...}, message: "success"}
âœ… Login success, user data: {...}
âš ï¸ åç«¯æœªè¿”å›Tokenï¼Œä½¿ç”¨ä¸´æ—¶Token: mock-token-student-20240001-1702598400000
ğŸ’¾ Tokenå·²ä¿å­˜: mock-token-student-20240001-1702598400000
ğŸ” æ£€æµ‹åˆ°é¦–æ¬¡ç™»å½•ï¼ˆä½¿ç”¨é»˜è®¤å¯†ç ï¼‰ï¼Œè·³è½¬åˆ°é¦–æ¬¡ç™»å½•è®¾ç½®é¡µé¢
ğŸš€ å‡†å¤‡è·³è½¬åˆ° /first-login
```

### 4. éªŒè¯ localStorage
åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
console.log('Token:', localStorage.getItem('token'));
console.log('StudentId:', localStorage.getItem('studentId'));
console.log('Role:', localStorage.getItem('role'));
```

åº”è¯¥çœ‹åˆ°ï¼š
```
Token: mock-token-student-20240001-1702598400000
StudentId: 20240001
Role: student
```

## ğŸ¯ å…³é”®ä»£ç ä½ç½®

### æ–‡ä»¶ï¼š`frontend/src/views/Login.vue`

**ä¿®æ”¹ä½ç½® 1**ï¼šç¬¬ 41-80 è¡Œ
```javascript
const handleLogin = async (role) => {
  // ... æ·»åŠ è°ƒè¯•æ—¥å¿—å’Œ token ä¿å­˜é€»è¾‘
}
```

**ä¿®æ”¹ä½ç½® 2**ï¼šç¬¬ 73-88 è¡Œ
```javascript
if (role === 'student') {
  // ... ä¿å­˜å­¦ç”Ÿä¿¡æ¯å’Œ token
  // ... æ£€æŸ¥é»˜è®¤å¯†ç å¹¶è·³è½¬
}
```

### æ–‡ä»¶ï¼š`frontend/src/router/index.js`

**è·¯ç”±å®ˆå«**ï¼šç¬¬ 54-72 è¡Œ
```javascript
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token') // æ£€æŸ¥è¿™é‡Œ
  // ...
})
```

## ğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨ Mock Tokenï¼Ÿ

### å½“å‰æƒ…å†µ
- åç«¯ `AuthService.java` åªè¿”å›ç”¨æˆ·æ•°æ®ï¼Œ**æ²¡æœ‰å®ç° JWT token**
- å‰ç«¯è·¯ç”±å®ˆå«éœ€è¦ token æ‰èƒ½æ”¾è¡Œ

### ä¸´æ—¶æ–¹æ¡ˆ
ä½¿ç”¨ mock token ç»•è¿‡éªŒè¯ï¼š
```javascript
const mockToken = `mock-token-${role}-${username.value}-${Date.now()}`;
```

### ç”Ÿäº§ç¯å¢ƒå»ºè®®
åç«¯åº”è¯¥å®ç°çœŸæ­£çš„ JWT tokenï¼š

```java
// AuthService.java ä¿®æ”¹å»ºè®®
private Result<?> loginStudent(String username, String password) {
    // ... éªŒè¯é€»è¾‘ ...
    
    // ç”Ÿæˆ JWT token
    String token = JwtUtil.generateToken(student.getXsXh(), "student");
    
    Map<String, Object> data = new HashMap<>();
    data.put("token", token);
    data.put("user", student);
    
    return Result.success(data);
}
```

## ğŸ”’ å®‰å…¨æ€§è¯´æ˜

### å½“å‰å®ç°ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- âœ… å¯ä»¥æ­£å¸¸è·³è½¬å’Œä½¿ç”¨åŠŸèƒ½
- âš ï¸ Token æ˜¯å‡çš„ï¼Œæ²¡æœ‰åŠ å¯†å’ŒéªŒè¯
- âš ï¸ ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

### ç”Ÿäº§ç¯å¢ƒéœ€è¦
1. **åç«¯å®ç° JWT**
   - ä½¿ç”¨ `io.jsonwebtoken` åº“
   - è®¾ç½®è¿‡æœŸæ—¶é—´
   - æ·»åŠ ç­¾åéªŒè¯

2. **å‰ç«¯éªŒè¯ Token**
   - æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
   - è‡ªåŠ¨åˆ·æ–° token
   - å¤„ç† token å¤±æ•ˆæƒ…å†µ

3. **HTTPS ä¼ è¾“**
   - é˜²æ­¢ token è¢«æˆªè·
   - ä½¿ç”¨å®‰å…¨çš„å­˜å‚¨æ–¹å¼

## ğŸ“ å…¶ä»–è§’è‰²ç™»å½•ä¿®å¤

åŒæ ·çš„ä¿®å¤ä¹Ÿåº”ç”¨åˆ°äº†è´Ÿè´£äººå’Œç®¡ç†å‘˜ç™»å½•ï¼š

```javascript
// è´Ÿè´£äººç™»å½•
else if (role === 'head') {
  // ä¿å­˜ token
  localStorage.setItem('token', mockToken);
  localStorage.setItem('role', 'head');
  // ...
}

// ç®¡ç†å‘˜ç™»å½•
else if (role === 'admin') {
  // ä¿å­˜ token
  localStorage.setItem('token', mockToken);
  localStorage.setItem('role', 'admin');
  // ...
}
```

## âœ… ä¿®å¤éªŒè¯æ¸…å•

- [x] ç™»å½•æˆåŠŸåä¿å­˜ token
- [x] æ·»åŠ è°ƒè¯•æ—¥å¿—ä¾¿äºæ’æŸ¥
- [x] è·¯ç”±å®ˆå«èƒ½å¤Ÿæ­£ç¡®éªŒè¯ token
- [x] é¦–æ¬¡ç™»å½•èƒ½å¤Ÿè·³è½¬åˆ°è®¾ç½®é¡µé¢
- [x] éé¦–æ¬¡ç™»å½•èƒ½å¤Ÿè·³è½¬åˆ°å¯¹åº”é¦–é¡µ
- [x] æ‰€æœ‰è§’è‰²éƒ½èƒ½æ­£å¸¸ç™»å½•

## ğŸš€ æµ‹è¯•å‘½ä»¤

```bash
# 1. å¯åŠ¨åç«¯
cd backend
mvn spring-boot:run

# 2. å¯åŠ¨å‰ç«¯
cd frontend
npm run dev

# 3. è®¿é—®
http://localhost:5173
```

## ğŸ“ å¦‚æœä»ç„¶æ— æ³•ç™»å½•

### æ£€æŸ¥æ¸…å•
1. âœ… åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ
2. âœ… æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ
3. âœ… Network æ ‡ç­¾ä¸­ login è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Ÿ
4. âœ… localStorage ä¸­æ˜¯å¦æœ‰ tokenï¼Ÿ
5. âœ… è·¯ç”±å®ˆå«æ˜¯å¦æ­£ç¡®é…ç½®ï¼Ÿ

### è°ƒè¯•æ­¥éª¤
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
console.log('Token:', localStorage.getItem('token'));
console.log('Role:', localStorage.getItem('role'));
console.log('StudentId:', localStorage.getItem('studentId'));

// æ‰‹åŠ¨è®¾ç½® token æµ‹è¯•
localStorage.setItem('token', 'test-token');
localStorage.setItem('role', 'student');
localStorage.setItem('studentId', '20240001');

// ç„¶åå°è¯•è®¿é—®
window.location.href = '/first-login';
```

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-12-15  
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶å¯æµ‹è¯•  
**å½±å“èŒƒå›´**: æ‰€æœ‰è§’è‰²ç™»å½•åŠŸèƒ½