# 首次登录强制修改密码功能测试指南

## 测试前准备

### 1. 确保系统运行
```bash
# 启动后端服务
cd backend
mvn spring-boot:run

# 启动前端服务
cd frontend
npm run dev
```

### 2. 准备测试账号
确保数据库中有使用默认密码（123456）的学生账号。

**测试账号示例**:
- 学号: 任意存在的学号
- 密码: 123456

## 测试用例

### 测试用例 1: 首次登录检测
**目的**: 验证使用默认密码登录时会跳转到首次登录设置页面

**步骤**:
1. 打开登录页面 `http://localhost:5173/`
2. 输入学号和密码 `123456`
3. 点击"学生"按钮登录

**预期结果**:
- ✅ 登录成功
- ✅ 自动跳转到 `/first-login` 页面
- ✅ 页面显示"欢迎加入志愿服务平台"标题
- ✅ 显示个人信息（姓名、学号、学院、班级）

**失败处理**:
- 如果跳转到学生首页，检查 Login.vue 中的密码判断逻辑
- 如果显示404，检查路由配置

---

### 测试用例 2: 个人信息加载
**目的**: 验证个人信息正确加载并显示

**步骤**:
1. 在首次登录设置页面
2. 查看"个人信息"区域

**预期结果**:
- ✅ 姓名字段显示正确且不可编辑
- ✅ 学号字段显示正确且不可编辑
- ✅ 学院字段显示正确且不可编辑
- ✅ 班级字段显示正确且不可编辑

**失败处理**:
- 检查浏览器控制台是否有API错误
- 验证 localStorage 中是否有 studentId
- 检查后端 `/api/student/profile` 接口

---

### 测试用例 3: 密码校验 - 空密码
**目的**: 验证空密码提示

**步骤**:
1. 不输入任何密码
2. 直接点击"完成设置"按钮

**预期结果**:
- ✅ 显示红色错误提示："请输入新密码"
- ✅ 不会提交表单

---

### 测试用例 4: 密码校验 - 使用默认密码
**目的**: 验证禁止使用默认密码

**步骤**:
1. 新密码输入框输入: `123456`
2. 确认密码输入框输入: `123456`
3. 点击"完成设置"按钮

**预期结果**:
- ✅ 显示红色错误提示："新密码不能为初始密码123456"
- ✅ 不会提交表单

---

### 测试用例 5: 密码校验 - 长度不足
**目的**: 验证密码长度限制

**步骤**:
1. 新密码输入框输入: `12345`（5位）
2. 确认密码输入框输入: `12345`
3. 点击"完成设置"按钮

**预期结果**:
- ✅ 显示红色错误提示："密码长度至少为6位"
- ✅ 不会提交表单

---

### 测试用例 6: 密码校验 - 两次不一致
**目的**: 验证密码一致性检查

**步骤**:
1. 新密码输入框输入: `password123`
2. 确认密码输入框输入: `password456`
3. 点击"完成设置"按钮

**预期结果**:
- ✅ 显示红色错误提示："两次输入的密码不一致"
- ✅ 不会提交表单

---

### 测试用例 7: 标签加载
**目的**: 验证标签列表正确加载

**步骤**:
1. 在首次登录设置页面
2. 查看"兴趣与技能标签"区域

**预期结果**:
- ✅ 显示兴趣标签列表（蓝色样式）
- ✅ 显示技能标签列表（绿色样式）
- ✅ 标签可以点击选中/取消

**失败处理**:
- 检查 `/api/tags` 接口是否正常
- 确认数据库中有标签数据
- 查看浏览器控制台错误

---

### 测试用例 8: 标签选择交互
**目的**: 验证标签选择功能

**步骤**:
1. 点击一个兴趣标签
2. 点击一个技能标签
3. 再次点击已选中的标签

**预期结果**:
- ✅ 首次点击：标签变为蓝色/绿色高亮
- ✅ 再次点击：标签取消选中，恢复白色
- ✅ 可以同时选择多个标签

---

### 测试用例 9: 仅修改密码（不选标签）
**目的**: 验证可以只修改密码不选标签

**步骤**:
1. 新密码输入框输入: `newpass123`
2. 确认密码输入框输入: `newpass123`
3. 不选择任何标签
4. 点击"完成设置"按钮

**预期结果**:
- ✅ 显示"提交中..."按钮状态
- ✅ 密码修改成功
- ✅ 显示"设置成功！欢迎使用志愿服务平台"提示
- ✅ 自动跳转到学生首页 `/student/dashboard`

**验证**:
- 退出登录
- 使用新密码 `newpass123` 重新登录
- 应该直接进入学生首页，不再跳转到设置页面

---

### 测试用例 10: 修改密码并选择标签
**目的**: 验证完整流程

**步骤**:
1. 新密码输入框输入: `newpass456`
2. 确认密码输入框输入: `newpass456`
3. 选择2-3个兴趣标签
4. 选择1-2个技能标签
5. 点击"完成设置"按钮

**预期结果**:
- ✅ 密码修改成功
- ✅ 标签更新成功
- ✅ 显示成功提示
- ✅ 跳转到学生首页

**验证**:
1. 在学生首页查看个人信息
2. 确认标签已正确保存
3. 退出登录，使用新密码重新登录
4. 应该直接进入学生首页

---

### 测试用例 11: 网络异常处理
**目的**: 验证错误处理机制

**步骤**:
1. 停止后端服务
2. 在首次登录页面填写信息
3. 点击"完成设置"按钮

**预期结果**:
- ✅ 显示错误提示
- ✅ 按钮恢复可点击状态
- ✅ 不会跳转页面

---

### 测试用例 12: 路由守卫测试
**目的**: 验证未登录无法访问设置页面

**步骤**:
1. 清除浏览器 localStorage
2. 直接访问 `http://localhost:5173/first-login`

**预期结果**:
- ✅ 自动跳转到登录页面 `/`
- ✅ 不显示首次登录设置页面

---

### 测试用例 13: 非学生角色访问
**目的**: 验证角色权限控制

**步骤**:
1. 使用负责人或管理员账号登录
2. 尝试访问 `/first-login`

**预期结果**:
- ✅ 跳转到登录页面或显示权限错误
- ✅ 不允许访问学生专用页面

---

### 测试用例 14: 后退按钮测试
**目的**: 验证设置完成后无法返回

**步骤**:
1. 完成首次登录设置
2. 跳转到学生首页后
3. 点击浏览器后退按钮

**预期结果**:
- ✅ 不会返回到首次登录设置页面
- ✅ 可能返回到登录页面或停留在当前页

---

### 测试用例 15: 非首次登录测试
**目的**: 验证已修改密码的用户正常登录

**步骤**:
1. 使用已修改过密码的学生账号登录
2. 输入新密码

**预期结果**:
- ✅ 登录成功
- ✅ 直接跳转到学生首页 `/student/dashboard`
- ✅ 不会跳转到首次登录设置页面

---

## 数据库验证

### 验证密码修改
```sql
-- 查看学生密码是否已更新
SELECT xs_xh, xs_xm, xs_mm 
FROM t_xs 
WHERE xs_xh = '你的学号';
```

### 验证标签关联
```sql
-- 查看学生标签关联
SELECT st.xs_xh, t.bq_mc, t.bq_lx
FROM t_xs_bq st
JOIN t_bq t ON st.bq_id = t.bq_id
WHERE st.xs_xh = '你的学号';
```

### 验证冗余字段
```sql
-- 查看学生表中的标签字段
SELECT xs_xh, xs_xm, xq_bq, jn_bq
FROM t_xs
WHERE xs_xh = '你的学号';
```

## 常见问题排查

### 问题1: 页面显示404
**原因**: 路由配置未生效
**解决**: 
- 检查 `frontend/src/router/index.js` 是否正确配置
- 重启前端开发服务器

### 问题2: 个人信息不显示
**原因**: API调用失败或数据格式不匹配
**解决**:
- 打开浏览器开发者工具查看Network标签
- 检查 `/api/student/profile` 接口返回数据
- 确认 localStorage 中有 studentId

### 问题3: 标签列表为空
**原因**: 数据库中没有标签数据
**解决**:
```sql
-- 插入测试标签
INSERT INTO t_bq (bq_mc, bq_lx) VALUES 
('环保', 1), ('教育', 1), ('文艺', 1),
('组织能力', 2), ('沟通能力', 2), ('技术能力', 2);
```

### 问题4: 密码修改失败
**原因**: 后端接口参数不匹配
**解决**:
- 检查请求体中是否包含 `studentIdFromStorage`
- 查看后端日志确认错误信息
- 验证 StudentController 的 updatePassword 方法

### 问题5: 标签更新失败
**原因**: 后端接口不存在或参数错误
**解决**:
- 确认 StudentController 中有 `/api/student/tags` 接口
- 检查 StudentService 中有 updateStudentTags 方法
- 查看后端日志

## 测试报告模板

```
测试日期: ____________________
测试人员: ____________________

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1. 首次登录检测 | ☐ 通过 ☐ 失败 | |
| 2. 个人信息加载 | ☐ 通过 ☐ 失败 | |
| 3. 空密码校验 | ☐ 通过 ☐ 失败 | |
| 4. 默认密码校验 | ☐ 通过 ☐ 失败 | |
| 5. 密码长度校验 | ☐ 通过 ☐ 失败 | |
| 6. 密码一致性校验 | ☐ 通过 ☐ 失败 | |
| 7. 标签加载 | ☐ 通过 ☐ 失败 | |
| 8. 标签选择交互 | ☐ 通过 ☐ 失败 | |
| 9. 仅修改密码 | ☐ 通过 ☐ 失败 | |
| 10. 完整流程 | ☐ 通过 ☐ 失败 | |
| 11. 网络异常处理 | ☐ 通过 ☐ 失败 | |
| 12. 路由守卫 | ☐ 通过 ☐ 失败 | |
| 13. 角色权限 | ☐ 通过 ☐ 失败 | |
| 14. 后退按钮 | ☐ 通过 ☐ 失败 | |
| 15. 非首次登录 | ☐ 通过 ☐ 失败 | |

总体评价: ____________________
发现问题: ____________________
```

## 性能测试建议

1. **并发测试**: 多个学生同时首次登录
2. **响应时间**: 记录各API的响应时间
3. **数据库压力**: 大量标签选择时的性能
4. **前端渲染**: 大量标签时的页面渲染性能

## 安全测试建议

1. **SQL注入**: 尝试在密码字段输入SQL语句
2. **XSS攻击**: 尝试输入脚本代码
3. **密码强度**: 测试各种弱密码
4. **会话劫持**: 测试token过期处理

---

**测试完成后请填写测试报告并提交！**