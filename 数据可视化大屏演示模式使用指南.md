# 数据可视化大屏 - 演示模式使用指南

## 📋 功能概述

本系统为数据可视化大屏页面实现了**演示模式（Mock Mode）**功能，可以在没有真实数据或后端服务的情况下，自动生成合理的模拟数据进行展示。

### ✨ 核心特性

1. **智能数据生成** - 七大卡片数据联动，确保逻辑自洽
2. **数据稳定性** - 同一会话中刷新页面数据不变
3. **实时增长效果** - 工时数据每 5 秒有 30% 概率自动 +1
4. **无缝切换** - 支持演示模式与真实模式自由切换

---

## 🚀 快速开始

### 方式一：通过 localStorage 启用（推荐）

在浏览器控制台执行：

```javascript
// 启用演示模式
localStorage.setItem('DASHBOARD_MODE', 'demo')

// 刷新页面生效
location.reload()
```

关闭演示模式：

```javascript
// 切换回真实模式
localStorage.setItem('DASHBOARD_MODE', 'real')
location.reload()

// 或直接删除配置
localStorage.removeItem('DASHBOARD_MODE')
location.reload()
```

### 方式二：通过 URL 参数启用

直接在 URL 后添加参数：

```
http://localhost:5173/student/dashboard?mode=demo
```

此方式仅对当前页面生效，刷新后失效。

---

## 📊 数据生成逻辑详解

### 1️⃣ 顶部三大指标（联动设计）

#### 累计活动数量
- **算法**：随机生成 100-300 之间的整数
- **作用**：作为其他指标的基准数据

#### 活跃志愿者
- **算法**：`活动数量 × random(15, 40)`
- **含义**：平均每个活动有 15-40 人参加
- **联动**：确保志愿者数量与活动数量成正比

#### 累计活动时长
- **算法**：`活跃志愿者 × random(5, 12)`
- **含义**：平均每人贡献 5-12 小时
- **修正**：自动调整到目标工时的 70%-110% 范围内
- **联动**：确保进度条显示合理

**示例数据关系：**
```
活动数量: 150
志愿者: 150 × 25 = 3,750 人
工时: 3,750 × 8 = 30,000 小时
目标: 5,000 小时 → 修正为 4,200 小时（84% 完成度）
```

---

### 2️⃣ 折线图：近半年活动趋势

#### 活动数量曲线
- **算法**：生成 6 个数据点，呈微弱上升趋势
- **基准值**：10
- **趋势系数**：+2/月
- **波动范围**：±2
- **示例**：`[10, 12, 15, 18, 20, 22]`

#### 参与人数曲线
- **算法**：`当月活动数 × random(20, 30)`
- **联动**：曲线走势与活动数量保持一致
- **示例**：`[200, 300, 450, 540, 600, 660]`

**为什么这样设计？**
- 两条曲线的峰谷位置一致，符合真实业务逻辑
- 避免出现"活动少但人多"的不合理情况

---

### 3️⃣ 饼图：各学院参与度占比

#### 数据结构
```javascript
[
  { name: '计算机学院', value: 320 },
  { name: '经济管理学院', value: 180 },
  { name: '机械工程学院', value: 250 },
  { name: '外国语学院', value: 150 },
  { name: '艺术学院', value: 200 },
  { name: '理学院', value: 280 }
]
```

#### 生成规则
- 每个学院随机生成 100-500 之间的数值
- ECharts 自动计算百分比，无需手动处理

---

### 4️⃣ 柱状图：活动参与率

#### 6 个月数据
- **算法**：生成 6 个数据点，范围 60%-95%
- **趋势**：呈波动上升
- **示例**：`[65, 70, 85, 88, 82, 92]`

#### 3 个月数据
- **算法**：直接截取 6 个月数据的后 3 位
- **目的**：确保切换按钮时数据一致性
- **示例**：`[88, 82, 92]`

**关键设计：**
```javascript
// ✅ 正确：数据联动
const values6 = [65, 70, 85, 88, 82, 92]
const values3 = values6.slice(-3)  // [88, 82, 92]

// ❌ 错误：独立生成
const values3 = [70, 75, 80]  // 10月数据不一致！
```

---

### 5️⃣ 饼图：男女参与比例

#### 生成规则
```javascript
const maleRatio = random(35, 65)      // 男生 35%-65%
const femaleRatio = 100 - maleRatio   // 女生自动计算
```

#### 数据结构
```javascript
[
  { name: '男', value: 58 },
  { name: '女', value: 42 }
]
```

**严格约束：** 两数之和必须等于 100

---

## 🔄 数据缓存机制

### sessionStorage 缓存

系统使用 `sessionStorage` 存储生成的模拟数据：

```javascript
// 缓存 Key
const CACHE_KEY = 'DASHBOARD_MOCK_DATA'

// 读取逻辑
1. 检查 sessionStorage 是否有缓存
2. 有 → 直接使用（刷新页面数据不变）
3. 无 → 生成新数据并缓存
```

### 缓存生命周期

- **持续时间**：当前浏览器标签页会话期间
- **失效时机**：关闭标签页或浏览器
- **刷新行为**：刷新页面数据保持不变

### 手动清除缓存

在控制台执行：

```javascript
sessionStorage.removeItem('DASHBOARD_MOCK_DATA')
location.reload()
```

---

## ⏱️ 实时增长效果

### 功能说明

模拟真实数据库的实时更新，让大屏看起来是"活"的。

### 实现逻辑

```javascript
// 每 5 秒执行一次
setInterval(() => {
  // 30% 概率触发
  if (Math.random() < 0.3) {
    累计工时 += 1
    console.log('⏱️ 实时工时 +1')
  }
}, 5000)
```

### 效果展示

```
初始工时: 4,200 小时
5秒后:   4,200 小时 (70% 概率不变)
10秒后:  4,201 小时 (30% 概率 +1) ✓
15秒后:  4,201 小时
20秒后:  4,202 小时 ✓
```

### 停止实时更新

切换回真实模式时自动停止。

---

## 🎯 使用场景

### 场景一：演示汇报

**需求：** 向领导展示系统功能，但数据库中数据不足

**操作：**
```javascript
localStorage.setItem('DASHBOARD_MODE', 'demo')
location.reload()
```

**效果：** 大屏显示丰富的模拟数据，所有图表正常展示

---

### 场景二：前端开发调试

**需求：** 后端接口未完成，前端需要独立开发

**操作：**
```
访问 URL: http://localhost:5173/student/dashboard?mode=demo
```

**效果：** 无需后端服务，前端可独立调试样式和交互

---

### 场景三：压力测试

**需求：** 测试大屏在不同数据量下的表现

**操作：**
```javascript
// 修改 mockData.js 中的数据范围
const totalActivities = randomInt(500, 1000)  // 增大数据量
```

**效果：** 快速生成大量数据进行测试

---

## 🛠️ 高级配置

### 自定义数据范围

编辑 `frontend/src/api/mockData.js`：

```javascript
// 修改活动数量范围
const totalActivities = randomInt(100, 300)  // 改为 randomInt(50, 150)

// 修改志愿者倍数
const activeVolunteers = totalActivities * randomInt(15, 40)  // 改为 (10, 30)

// 修改参与率范围
const participation6m = generateTrendArray(6, 65, 3, 5)  // 改为 (6, 50, 2, 3)
```

### 添加新的学院

```javascript
const academies = [
  '计算机学院',
  '经济管理学院',
  '机械工程学院',
  '外国语学院',
  '艺术学院',
  '理学院',
  '新增学院名称'  // 添加这里
]
```

### 调整实时增长频率

编辑 `DashboardHome.vue`：

```javascript
// 修改检查间隔（毫秒）
liveUpdateTimer = window.setInterval(() => {
  if (Math.random() < 0.3) {  // 修改概率
    metrics.value.totalHours += 1  // 修改增长量
  }
}, 5000)  // 修改间隔时间
```

---

## 🐛 故障排查

### 问题 1：演示模式未生效

**检查步骤：**
1. 打开浏览器控制台
2. 执行 `localStorage.getItem('DASHBOARD_MODE')`
3. 确认返回值为 `"demo"` 或 `"mock"`

**解决方案：**
```javascript
localStorage.setItem('DASHBOARD_MODE', 'demo')
location.reload()
```

---

### 问题 2：数据显示不合理

**可能原因：** 缓存了旧数据

**解决方案：**
```javascript
// 清除缓存
sessionStorage.removeItem('DASHBOARD_MOCK_DATA')
location.reload()
```

---

### 问题 3：实时增长不工作

**检查步骤：**
1. 确认演示模式已启用
2. 打开控制台查看是否有 `⏱️ 实时工时 +1` 日志

**解决方案：**
- 等待 5 秒观察
- 如果仍无反应，刷新页面

---

### 问题 4：TypeScript 类型错误

**错误信息：** `类型"Object"上不存在属性"metrics"`

**解决方案：**

编辑 `mockData.js`，添加 JSDoc 类型注释：

```javascript
/**
 * @typedef {Object} MockData
 * @property {Object} metrics
 * @property {number} metrics.totalActivities
 * @property {number} metrics.activeVolunteers
 * @property {number} metrics.totalHours
 * ...
 */

/**
 * @returns {MockData}
 */
export const generateDashboardMock = (goalTotalHours = 5000) => {
  // ...
}
```

---

## 📝 开发者注意事项

### 1. 数据联动原则

所有随机数据必须保持逻辑自洽：

```javascript
// ✅ 正确：基于活动数量计算志愿者
const volunteers = activities * randomInt(15, 40)

// ❌ 错误：独立随机
const volunteers = randomInt(1000, 5000)  // 可能出现 1 个活动 5000 人
```

### 2. 数值范围控制

确保数据在合理范围内：

```javascript
// ✅ 正确：限制参与率在 60%-95%
const rate = Math.min(95, Math.max(60, generatedValue))

// ❌ 错误：可能超过 100%
const rate = randomInt(50, 120)
```

### 3. 缓存管理

开发时注意清除缓存：

```javascript
// 开发环境自动清除缓存（可选）
if (import.meta.env.DEV) {
  sessionStorage.removeItem('DASHBOARD_MOCK_DATA')
}
```

---

## 🎓 最佳实践

### 1. 演示前准备

```javascript
// 1. 启用演示模式
localStorage.setItem('DASHBOARD_MODE', 'demo')

// 2. 清除旧缓存
sessionStorage.removeItem('DASHBOARD_MOCK_DATA')

// 3. 刷新页面
location.reload()

// 4. 确认右上角显示 "🎭 演示模式"
```

### 2. 演示后恢复

```javascript
// 1. 关闭演示模式
localStorage.removeItem('DASHBOARD_MODE')

// 2. 刷新页面
location.reload()
```

### 3. 数据调试

```javascript
// 在控制台查看当前模拟数据
JSON.parse(sessionStorage.getItem('DASHBOARD_MOCK_DATA'))
```

---

## 📞 技术支持

如有问题，请检查：

1. **浏览器控制台** - 查看错误日志
2. **网络面板** - 确认是否调用了后端接口
3. **Vue DevTools** - 检查组件状态

---

## 🎉 总结

演示模式功能已完整实现，具备以下优势：

✅ **智能生成** - 七大卡片数据联动，逻辑自洽  
✅ **稳定可靠** - 缓存机制确保数据一致性  
✅ **真实感强** - 实时增长效果模拟真实场景  
✅ **易于使用** - 一行代码即可启用  
✅ **灵活配置** - 支持自定义数据范围  

现在您可以随时切换到演示模式，进行系统展示和功能演示！🚀