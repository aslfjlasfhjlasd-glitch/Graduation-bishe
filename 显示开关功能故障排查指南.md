# æ˜¾ç¤ºå¼€å…³åŠŸèƒ½æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ“‹ é—®é¢˜æè¿°

**é—®é¢˜ï¼š** åœ¨å¤§å±ç»´æŠ¤é¡µé¢å…³é—­"æ˜¾ç¤ºç”·å¥³å‚ä¸æ¯”ä¾‹"å¼€å…³å¹¶ä¿å­˜é…ç½®åï¼Œæ•°æ®å¯è§†åŒ–å¤§å±é¡µé¢çš„ç”·å¥³å‚ä¸æ¯”ä¾‹å›¾è¡¨ä»ç„¶æ˜¾ç¤ºã€‚

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 

é…ç½®çš„åŠ è½½å’Œå›¾è¡¨åˆå§‹åŒ–çš„æ—¶åºé—®é¢˜ï¼š

1. **é…ç½®åŠ è½½æ˜¯å¼‚æ­¥çš„** - `loadDashboardConfig()` ä»åç«¯è·å–é…ç½®
2. **å›¾è¡¨åˆå§‹åŒ–ä¾èµ–é…ç½®** - å¿…é¡»åœ¨é…ç½®åŠ è½½å®Œæˆåæ‰èƒ½æ­£ç¡®åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–å›¾è¡¨
3. **æ¨¡æ¿æ¸²æŸ“ä¾èµ–é…ç½®** - `v-if="dashboardConfig.show_gender_ratio"` éœ€è¦æ­£ç¡®çš„é…ç½®å€¼

### é—®é¢˜ä»£ç æµç¨‹

```javascript
// âŒ é—®é¢˜ï¼šé…ç½®å¯èƒ½è¿˜æœªåŠ è½½å®Œæˆå°±åˆå§‹åŒ–å›¾è¡¨
onMounted(async () => {
  await loadDashboardConfig()  // å¼‚æ­¥åŠ è½½é…ç½®
  
  // å¦‚æœé…ç½®åŠ è½½æœ‰å»¶è¿Ÿï¼Œè¿™é‡Œå¯èƒ½ä½¿ç”¨çš„æ˜¯é»˜è®¤å€¼ true
  if (dashboardConfig.value.show_gender_ratio) {
    await initGenderPieChart()  // é”™è¯¯åœ°åˆå§‹åŒ–äº†å›¾è¡¨
  }
})
```

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ç¡®ä¿é…ç½®ä¼˜å…ˆåŠ è½½

```javascript
onMounted(async () => {
  // 1. æ£€æŸ¥æ¼”ç¤ºæ¨¡å¼
  isMockMode.value = checkMockMode()
  
  // 2. åŠ è½½åŸºç¡€é…ç½®ï¼ˆå¿…é¡»å…ˆåŠ è½½é…ç½®ï¼‰
  await loadDashboardConfig()
  
  // 3. æ·»åŠ æ—¥å¿—ç¡®è®¤é…ç½®å·²åŠ è½½
  console.log('ğŸ“‹ é…ç½®åŠ è½½å®Œæˆ:', {
    show_academy_rank: dashboardConfig.value.show_academy_rank,
    show_gender_ratio: dashboardConfig.value.show_gender_ratio
  })
  
  // 4. æ ¹æ®é…ç½®åˆå§‹åŒ–å›¾è¡¨
  if (dashboardConfig.value.show_gender_ratio) {
    await initGenderPieChart()
    console.log('âœ… ç”·å¥³æ¯”ä¾‹å›¾è¡¨å·²åˆå§‹åŒ–')
  } else {
    console.log('â­ï¸ ç”·å¥³æ¯”ä¾‹å›¾è¡¨å·²è·³è¿‡')
  }
})
```

### 2. é…ç½®åŠ è½½é€»è¾‘

```javascript
const loadDashboardConfig = async () => {
  try {
    const response = await axios.get(`${API_BASE}/api/dashboard/configs`)
    if (response.data.code === 200) {
      const configs: Record<string, any> = response.data.data || {}
      
      // æ­£ç¡®å¤„ç†å¸ƒå°”å€¼
      if ('show_gender_ratio' in configs) {
        dashboardConfig.value.show_gender_ratio = 
          configs.show_gender_ratio === 'true' || 
          configs.show_gender_ratio === true
      }
      
      console.log('âœ… å¤§å±é…ç½®åŠ è½½æˆåŠŸ:', dashboardConfig.value)
    }
  } catch (error: any) {
    console.error('âŒ åŠ è½½å¤§å±é…ç½®å¤±è´¥:', error)
  }
}
```

### 3. æ¨¡æ¿æ¡ä»¶æ¸²æŸ“

```vue
<!-- åªæœ‰å½“é…ç½®ä¸º true æ—¶æ‰æ¸²æŸ“ -->
<Card
  v-if="dashboardConfig.show_gender_ratio"
  class="md:col-span-5 lg:col-span-4 hover:shadow-lg transition-shadow duration-300"
>
  <CardContent class="p-6">
    <div class="flex items-center gap-2 h-[28px] mb-4">
      <PieChart class="w-5 h-5 text-indigo-500" />
      <h3 class="text-lg font-semibold text-slate-800">ç”·å¥³å‚ä¸æ¯”ä¾‹</h3>
    </div>
    <div class="relative w-full h-[300px]">
      <div ref="genderPieRef" class="absolute inset-0"></div>
    </div>
  </CardContent>
</Card>
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1ï¼šå…³é—­ç”·å¥³æ¯”ä¾‹æ˜¾ç¤º

1. **è¿›å…¥ç®¡ç†åå°** â†’ "å¤§å±ç»´æŠ¤"
2. **å…³é—­å¼€å…³** - "æ˜¾ç¤ºç”·å¥³å‚ä¸æ¯”ä¾‹"
3. **ç‚¹å‡»ä¿å­˜** - çœ‹åˆ°æç¤º"é…ç½®ä¿å­˜æˆåŠŸï¼"
4. **æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°**
5. **åˆ·æ–°å¤§å±é¡µé¢** æˆ– **æ–°æ‰“å¼€å¤§å±é¡µé¢**
6. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**ï¼š
   ```
   ğŸ“‹ é…ç½®åŠ è½½å®Œæˆ: { show_gender_ratio: false, ... }
   â­ï¸ ç”·å¥³æ¯”ä¾‹å›¾è¡¨å·²è·³è¿‡
   ```
7. **éªŒè¯é¡µé¢** - ç”·å¥³å‚ä¸æ¯”ä¾‹å¡ç‰‡åº”è¯¥ä¸æ˜¾ç¤º

### æµ‹è¯• 2ï¼šå¼€å¯ç”·å¥³æ¯”ä¾‹æ˜¾ç¤º

1. **è¿›å…¥ç®¡ç†åå°** â†’ "å¤§å±ç»´æŠ¤"
2. **å¼€å¯å¼€å…³** - "æ˜¾ç¤ºç”·å¥³å‚ä¸æ¯”ä¾‹"
3. **ç‚¹å‡»ä¿å­˜**
4. **åˆ·æ–°å¤§å±é¡µé¢**
5. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**ï¼š
   ```
   ğŸ“‹ é…ç½®åŠ è½½å®Œæˆ: { show_gender_ratio: true, ... }
   âœ… ç”·å¥³æ¯”ä¾‹å›¾è¡¨å·²åˆå§‹åŒ–
   ```
6. **éªŒè¯é¡µé¢** - ç”·å¥³å‚ä¸æ¯”ä¾‹å¡ç‰‡åº”è¯¥æ˜¾ç¤º

### æµ‹è¯• 3ï¼šå­¦é™¢æ’åå¼€å…³

åŒæ ·çš„æµ‹è¯•æµç¨‹ï¼ŒéªŒè¯å­¦é™¢æ’åå¼€å…³æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®ä¿å­˜

åœ¨ç®¡ç†åå°çš„æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// æŸ¥çœ‹å½“å‰è¡¨å•æ•°æ®
console.log('è¡¨å•æ•°æ®:', formData.value)

// æŸ¥çœ‹ä¿å­˜çš„é…ç½®
fetch('http://localhost:8080/api/dashboard/configs')
  .then(r => r.json())
  .then(d => console.log('åç«¯é…ç½®:', d))
```

### 2. æ£€æŸ¥å¤§å±é¡µé¢é…ç½®åŠ è½½

åœ¨å¤§å±é¡µé¢çš„æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// æŸ¥çœ‹å½“å‰é…ç½®
console.log('å½“å‰é…ç½®:', dashboardConfig.value)

// é‡æ–°åŠ è½½é…ç½®
await loadDashboardConfig()
console.log('é‡æ–°åŠ è½½å:', dashboardConfig.value)
```

### 3. æ£€æŸ¥å›¾è¡¨å®ä¾‹

```javascript
// æŸ¥çœ‹å›¾è¡¨å®ä¾‹æ˜¯å¦å­˜åœ¨
console.log('å›¾è¡¨å®ä¾‹:', {
  lineChart: !!lineChart,
  pieChart: !!pieChart,
  barChart: !!barChart,
  genderPieChart: !!genderPieChart
})
```

## ğŸ“Š é…ç½®æ•°æ®æµ

```
ç®¡ç†åå°
  â†“
[ä¿å­˜é…ç½®] â†’ åç«¯æ•°æ®åº“
  â†“
å¤§å±é¡µé¢åˆ·æ–°
  â†“
[loadDashboardConfig()] â†’ ä»åç«¯è·å–é…ç½®
  â†“
[dashboardConfig.value] â†’ æ›´æ–°å“åº”å¼é…ç½®
  â†“
[onMounted] â†’ æ ¹æ®é…ç½®åˆå§‹åŒ–å›¾è¡¨
  â†“
[v-if] â†’ æ ¹æ®é…ç½®æ¸²æŸ“æ¨¡æ¿
```

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¿å­˜ååˆ·æ–°é¡µé¢ï¼Œé…ç½®æ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. åç«¯æ˜¯å¦æ­£ç¡®ä¿å­˜äº†é…ç½®
2. å‰ç«¯æ˜¯å¦æ­£ç¡®è¯»å–äº†é…ç½®
3. æµè§ˆå™¨ç¼“å­˜æ˜¯å¦å½±å“ï¼ˆå°è¯•ç¡¬åˆ·æ–° Ctrl+F5ï¼‰

### Q2: æ§åˆ¶å°æ˜¾ç¤ºé…ç½®æ­£ç¡®ï¼Œä½†å›¾è¡¨ä»ç„¶æ˜¾ç¤ºï¼Ÿ

**A:** å¯èƒ½æ˜¯å›¾è¡¨å®ä¾‹å·²ç»åˆ›å»ºï¼Œéœ€è¦ï¼š
1. å®Œå…¨åˆ·æ–°é¡µé¢ï¼ˆä¸æ˜¯çƒ­é‡è½½ï¼‰
2. æ£€æŸ¥ `v-if` æ¡ä»¶æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªå›¾è¡¨å®ä¾‹

### Q3: å¼€å…³åˆ‡æ¢åï¼Œé¢„è§ˆæ­£å¸¸ä½†å¤§å±ä¸æ­£å¸¸ï¼Ÿ

**A:** é¢„è§ˆå’Œå¤§å±æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼š
- é¢„è§ˆï¼š`DashboardMaintenance.vue` çš„ `previewConfig`
- å¤§å±ï¼š`DashboardHome.vue` çš„ `dashboardConfig`
- ç¡®ä¿ä¸¤è€…éƒ½æ­£ç¡®è¯»å–äº†é…ç½®

## ğŸ¯ éªŒæ”¶æ ‡å‡†

- âœ… å…³é—­"æ˜¾ç¤ºç”·å¥³å‚ä¸æ¯”ä¾‹"å¼€å…³ â†’ ä¿å­˜ â†’ åˆ·æ–°å¤§å± â†’ å›¾è¡¨æ¶ˆå¤±
- âœ… å¼€å¯"æ˜¾ç¤ºç”·å¥³å‚ä¸æ¯”ä¾‹"å¼€å…³ â†’ ä¿å­˜ â†’ åˆ·æ–°å¤§å± â†’ å›¾è¡¨æ˜¾ç¤º
- âœ… å…³é—­"æ˜¾ç¤ºå­¦é™¢æ’å"å¼€å…³ â†’ ä¿å­˜ â†’ åˆ·æ–°å¤§å± â†’ å›¾è¡¨æ¶ˆå¤±
- âœ… å¼€å¯"æ˜¾ç¤ºå­¦é™¢æ’å"å¼€å…³ â†’ ä¿å­˜ â†’ åˆ·æ–°å¤§å± â†’ å›¾è¡¨æ˜¾ç¤º
- âœ… æ§åˆ¶å°æ—¥å¿—æ­£ç¡®æ˜¾ç¤ºé…ç½®çŠ¶æ€
- âœ… å¸ƒå±€è‡ªåŠ¨è°ƒæ•´ï¼ˆå…³é—­ä¸€ä¸ªå›¾è¡¨åï¼Œå¦ä¸€ä¸ªå›¾è¡¨å æ»¡å®½åº¦ï¼‰

## ğŸ“ ä¿®æ”¹è®°å½•

### 2025-12-13

**ä¿®æ”¹æ–‡ä»¶ï¼š** `frontend/src/views/student/components/DashboardHome.vue`

**ä¿®æ”¹å†…å®¹ï¼š**
1. åœ¨ `onMounted` ä¸­æ·»åŠ é…ç½®åŠ è½½æ—¥å¿—
2. æ·»åŠ å›¾è¡¨åˆå§‹åŒ–çŠ¶æ€æ—¥å¿—
3. ç¡®ä¿é…ç½®åŠ è½½å®Œæˆåå†åˆå§‹åŒ–å›¾è¡¨

**ä¿®æ”¹ä»£ç ï¼š**
```javascript
// ç¬¬ 567-605 è¡Œ
onMounted(async () => {
  // 1. æ£€æŸ¥æ¼”ç¤ºæ¨¡å¼
  isMockMode.value = checkMockMode()
  
  // 2. åŠ è½½åŸºç¡€é…ç½®ï¼ˆå¿…é¡»å…ˆåŠ è½½é…ç½®ï¼‰
  await loadDashboardConfig()
  
  console.log('ğŸ“‹ é…ç½®åŠ è½½å®Œæˆ:', {
    show_academy_rank: dashboardConfig.value.show_academy_rank,
    show_gender_ratio: dashboardConfig.value.show_gender_ratio
  })
  
  // 3. åˆå§‹åŒ–å›¾è¡¨å®ä¾‹ï¼ˆç©ºå›¾è¡¨ï¼‰- æ ¹æ®é…ç½®å†³å®šæ˜¯å¦åˆå§‹åŒ–
  await initLineChart()
  
  if (dashboardConfig.value.show_academy_rank) {
    await initPieChart()
    console.log('âœ… å­¦é™¢æ’åå›¾è¡¨å·²åˆå§‹åŒ–')
  } else {
    console.log('â­ï¸ å­¦é™¢æ’åå›¾è¡¨å·²è·³è¿‡')
  }
  
  await initBarChart()
  
  if (dashboardConfig.value.show_gender_ratio) {
    await initGenderPieChart()
    console.log('âœ… ç”·å¥³æ¯”ä¾‹å›¾è¡¨å·²åˆå§‹åŒ–')
  } else {
    console.log('â­ï¸ ç”·å¥³æ¯”ä¾‹å›¾è¡¨å·²è·³è¿‡')
  }
  
  // 4. æ•°æ®æ³¨å…¥
  if (isMockMode.value) {
    runMockDataLogic()
    showToast('ğŸ­ å½“å‰ä¸ºæ¼”ç¤ºæ•°æ®æ¨¡å¼')
  } else {
    await fetchRealData()
  }
  
  // 5. ç›‘å¬çª—å£å¤§å°å˜åŒ–
  window.addEventListener('resize', handleResize)
})
```

## ğŸ‰ æ€»ç»“

é€šè¿‡æ·»åŠ è¯¦ç»†çš„æ—¥å¿—å’Œç¡®ä¿é…ç½®åŠ è½½çš„æ—¶åºï¼Œç°åœ¨å¯ä»¥ï¼š

1. **å‡†ç¡®è¿½è¸ª** - é€šè¿‡æ§åˆ¶å°æ—¥å¿—äº†è§£é…ç½®åŠ è½½çŠ¶æ€
2. **æ­£ç¡®åˆå§‹åŒ–** - æ ¹æ®é…ç½®å†³å®šæ˜¯å¦åˆå§‹åŒ–å›¾è¡¨
3. **åŠ¨æ€æ¸²æŸ“** - æ¨¡æ¿æ ¹æ®é…ç½®åŠ¨æ€æ˜¾ç¤º/éšè—
4. **æ˜“äºè°ƒè¯•** - æ¸…æ™°çš„æ—¥å¿—å¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜

ç°åœ¨"æ˜¾ç¤ºç”·å¥³å‚ä¸æ¯”ä¾‹"å’Œ"æ˜¾ç¤ºå­¦é™¢æ’å"å¼€å…³åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å·¥ä½œäº†ï¼